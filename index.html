<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Responsive Neumorphic Chart + Slider</title>

  <!-- Chart.js + Plugins -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.3/build/global/luxon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1"></script>

  <!-- noUiSlider -->
  <link 
    href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.0/nouislider.min.css" 
    rel="stylesheet" 
  />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.0/nouislider.min.js"></script>

  <style>
    :root {
      /* Light theme */
      --bg-color: #f8fafb;
      --bg-gradient-start: #f8fafb;
      --bg-gradient-end:   #e8ecf0;
      --shadow-dark: rgba(0,0,0,0.08);
      --shadow-light: rgba(255,255,255,0.7);
      --text-color: #6c7a89;
      --chart-line: #36A2EB;
      --chart-grad-start: rgba(54,162,235,0.6);
      --chart-grad-end:   rgba(54,162,235,0.1);
      --highlight-above:  rgba(144,238,144,0.4);
      --highlight-below:  rgba(173,216,230,0.2);
    }
    .dark {
      /* Dark theme */
      --bg-color: #1f1f1f;
      --bg-gradient-start: #1f1f1f;
      --bg-gradient-end:   #262626;
      --shadow-dark: rgba(0,0,0,0.6);
      --shadow-light: rgba(255,255,255,0.1);
      --text-color: #d1d1d1;
      --chart-line: #dfe6ef;
      --chart-grad-start: rgba(78,154,241,0.6);
      --chart-grad-end:   rgba(78,154,241,0.1);
      --highlight-above:  rgba(144,238,144,0.4);
      --highlight-below:  rgba(173,216,230,0.2);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: linear-gradient(145deg, var(--bg-gradient-start), var(--bg-gradient-end));
      font-family: 'Segoe UI', sans-serif;
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding-top: 2rem;
      transition: background 0.3s, color 0.3s;
    }

    /* Toggle Switch */
    .switch {
      position: relative;
      width: 60px;
      height: 34px;
      margin-bottom: 2rem;
    }
    .switch input {
      opacity: 0; width: 0; height: 0;
    }
    .slider-switch {
      position: absolute; cursor: pointer;
      top: 0; left: 0; right: 0; bottom: 0;
      background: var(--bg-color);
      box-shadow: 4px 4px 12px var(--shadow-dark), -4px -4px 12px var(--shadow-light);
      border-radius: 34px;
      transition: background 0.3s, box-shadow 0.3s;
    }
    .slider-switch:before {
      content:""; position:absolute;
      height:26px; width:26px;
      left:4px; bottom:4px;
      background: var(--bg-gradient-start);
      box-shadow:2px 2px 6px var(--shadow-dark), -2px -2px 6px var(--shadow-light);
      border-radius:50%;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    input:checked + .slider-switch {
      box-shadow: inset 4px 4px 12px var(--shadow-dark), inset -4px -4px 12px var(--shadow-light);
    }
    input:checked + .slider-switch:before {
      transform: translateX(26px);
    }

    /* Chart card */
    .container {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 90%;
      max-width: 800px;
    }
    .box {
      background: var(--bg-color);
      border-radius: 20px;
      padding: 2rem;
      box-shadow:
        10px 10px 30px var(--shadow-dark),
        -10px -10px 30px var(--shadow-light),
        inset 4px 4px 15px var(--shadow-dark),
        inset -4px -4px 15px var(--shadow-light);
      transition: box-shadow 0.3s, background 0.3s;
      width: 100%;
    }

    /* Flex + scrolling */
    .dual {
      display: flex;
      align-items: center;
      width: 100%;
      overflow-x: auto;
    }
    #slider {
      flex: 0 0 20px;
      margin-right: 30px;
    }
    .chart-wrapper {
      flex: 1 1 0;
      min-width: 200px;
    }
    .chart-wrapper canvas {
      width: 100% !important;
      height: 300px !important;
      border-radius: 12px;
    }

    @media (max-width:600px) {
      .dual { flex-wrap: nowrap; }
    }
  </style>
</head>

<body>
  <!-- theme toggle -->
  <label class="switch">
    <input type="checkbox" id="themeToggle">
    <span class="slider-switch"></span>
  </label>

  <div class="container">
    <div class="box">
      <div class="dual">
        <!-- slider -->
        <div id="slider"></div>
        <!-- scrollable chart -->
        <div class="chart-wrapper">
          <canvas id="timeSeriesChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <script>
    // theme toggle
    const bodyEl = document.body;
    document.getElementById('themeToggle')
      .addEventListener('change', e => {
        bodyEl.classList.toggle('dark', e.target.checked);
        if (window.myChart) window.myChart.update();
      });
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // 1) Sample data
      const data = Array.from({length: 100}, (_,i) => ({
        time: luxon.DateTime.fromISO('2025-05-01').plus({days:i}).toISODate(),
        value: Math.random()*15
      }));

      const ctx = document.getElementById('timeSeriesChart').getContext('2d');

      // 2) Safe gradient factory with fallbacks
      function makeGradient() {
        const h = 300;
        const g = ctx.createLinearGradient(0, 0, 0, h);
        const root = getComputedStyle(document.documentElement);
        const start = root.getPropertyValue('--chart-grad-start').trim() || 'rgba(54,162,235,0.6)';
        const end   = root.getPropertyValue('--chart-grad-end').trim()   || 'rgba(54,162,235,0.1)';
        g.addColorStop(0, start);
        g.addColorStop(1, end);
        return g;
      }

      // 3) Threshold-line plugin
      const thresholdPlugin = {
        id: 'thresholdPlugin',
        beforeDraw(c) {
          const {ctx, chartArea:{left,right}, scales:{y}} = c;
          const {min,max} = c.config.options.thresholds;
          ctx.save(); ctx.setLineDash([6,4]);
          ctx.strokeStyle='crimson';
          ctx.beginPath();
          ctx.moveTo(left, y.getPixelForValue(min));
          ctx.lineTo(right, y.getPixelForValue(min));
          ctx.stroke();
          ctx.strokeStyle='seagreen';
          ctx.beginPath();
          ctx.moveTo(left, y.getPixelForValue(max));
          ctx.lineTo(right, y.getPixelForValue(max));
          ctx.stroke();
          ctx.restore();
        }
      };

      // 4) Sync slider to exact chart y-scale
      const syncHeightPlugin = {
        id: 'syncHeightPlugin',
        afterLayout(c) {
          const sliderEl = document.getElementById('slider');
          const yScale = c.scales.y;
          const topPx    = yScale.getPixelForValue(c.options.scales.y.max);
          const bottomPx = yScale.getPixelForValue(c.options.scales.y.min);
          const OFFSET = 0; 
          sliderEl.style.marginTop = `${topPx - OFFSET}px`;
          sliderEl.style.height    = `${(bottomPx - topPx) + (OFFSET*2)}px`;
        }
      };

      // 5) Instantiate Chart.js
      window.myChart = new Chart(ctx, {
        type:'line',
        data:{ datasets:[{
          label:'Series',
          data: data.map(d=>({x:d.time,y:d.value})),
          fill:true,
          backgroundColor: makeGradient(),
          borderColor: getComputedStyle(document.documentElement).getPropertyValue('--chart-line').trim(),
          pointRadius:4,
          pointBackgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--chart-line').trim(),
          tension:0.3
        }]},
        options:{
          responsive:true,
          maintainAspectRatio:false,
          scales:{
            x:{
              type:'time',
              time:{ unit:'day', tooltipFormat:'MMM dd' },
              grid:{ display:false },
              ticks:{ color:getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim() }
            },
            y:{
              min:0, max:15,
              grid:{
                drawBorder:false,
                color:getComputedStyle(document.documentElement).getPropertyValue('--shadow-dark').trim()
              },
              ticks:{ color:getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim() }
            }
          },
          plugins:{
            legend:{ display:false },
            tooltip:{ /* your styling */ },
            zoom:{
              pan:{ enabled:true, mode:'x', overScale:true },
              zoom:{ wheel:{ enabled:false }, pinch:{ enabled:false } }
            }
          },
          thresholds:{ min:5, max:10 }
        },
        plugins:[ syncHeightPlugin, thresholdPlugin ]
      });

      // 6) Initialize noUiSlider
      const slider = document.getElementById('slider');
      noUiSlider.create(slider, {
        start:[5,10],
        connect:true,
        orientation:'vertical',
        direction:'rtl',
        range:{min:0,max:15},
        step:0.1,
        tooltips:[true,true],
        format:{ to:v=>v.toFixed(1), from:v=>+v }
      });

      // 7) Update chart on slider move
      slider.noUiSlider.on('update', ([min,max]) => {
        min=+min; max=+max;
        myChart.options.thresholds.min = min;
        myChart.options.thresholds.max = max;
        const base = getComputedStyle(document.documentElement).getPropertyValue('--chart-line').trim();
        myChart.data.datasets[0].pointBackgroundColor =
          data.map(d=> (d.value>=min && d.value<=max) ? 'seagreen' : base);
        myChart.update('none');
      });

      // 8) Align once
      slider.noUiSlider.emit('update');
    });
  </script>
</body>
</html>
