<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Elegant Neumorphic Chart with Perfectly Aligned Slider</title>

  <!-- Chart.js + Luxon adapter -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.3/build/global/luxon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1"></script>

  <!-- noUiSlider CSS & JS -->
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.0/nouislider.min.css"
    rel="stylesheet"
  />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.0/nouislider.min.js"></script>

  <style>
    :root {
      /* Light theme */
      --bg-color: #f8fafb;
      --bg-gradient-start: #f8fafb;
      --bg-gradient-end:   #e8ecf0;
      --shadow-dark: rgba(0,0,0,0.08);
      --shadow-light: rgba(255,255,255,0.7);
      --text-color: #6c7a89;
      --chart-line: #36A2EB;
      --chart-grad-start: rgba(54,162,235,0.6);
      --chart-grad-end:   rgba(54,162,235,0.1);
      --highlight-above:  rgba(144,238,144,0.4);
      --highlight-below:  rgba(173,216,230,0.2);
    }
    .dark {
      /* Dark theme */
      --bg-color: #1f1f1f;
      --bg-gradient-start: #1f1f1f;
      --bg-gradient-end:   #262626;
      --shadow-dark: rgba(0,0,0,0.6);
      --shadow-light: rgba(255,255,255,0.1);
      --text-color: #d1d1d1;
      --chart-line: #dfe6ef;
      --chart-grad-start: rgba(78,154,241,0.6);
      --chart-grad-end:   rgba(78,154,241,0.1);
      --highlight-above:  rgba(144,238,144,0.4);
      --highlight-below:  rgba(173,216,230,0.2);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: linear-gradient(145deg, var(--bg-gradient-start), var(--bg-gradient-end));
      font-family: 'Segoe UI', sans-serif;
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding-top: 2rem;
      transition: background 0.3s, color 0.3s;
    }

    /* Toggle Switch */
    .switch {
      position: relative;
      width: 60px;
      height: 34px;
      margin-bottom: 2rem;
    }
    .switch input {
      opacity: 0; width: 0; height: 0;
    }
    .slider-switch {
      position: absolute; cursor: pointer;
      top: 0; left: 0; right: 0; bottom: 0;
      background: var(--bg-color);
      box-shadow: 4px 4px 12px var(--shadow-dark), -4px -4px 12px var(--shadow-light);
      border-radius: 34px;
      transition: background 0.3s, box-shadow 0.3s;
    }
    .slider-switch:before {
      content:""; position:absolute;
      height:26px; width:26px;
      left:4px; bottom:4px;
      background: var(--bg-gradient-start);
      box-shadow:2px 2px 6px var(--shadow-dark), -2px -2px 6px var(--shadow-light);
      border-radius:50%;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    input:checked + .slider-switch {
      box-shadow: inset 4px 4px 12px var(--shadow-dark), inset -4px -4px 12px var(--shadow-light);
    }
    input:checked + .slider-switch:before {
      transform: translateX(26px);
    }

    /* Chart card */
    .container {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 90%;
      max-width: 800px;
    }
    .box {
      background: var(--bg-color);
      border-radius: 20px;
      padding: 2rem;
      box-shadow:
        10px 10px 30px var(--shadow-dark),
        -10px -10px 30px var(--shadow-light),
        inset 4px 4px 15px var(--shadow-dark),
        inset -4px -4px 15px var(--shadow-light);
      transition: box-shadow 0.3s, background 0.3s;
      width: 100%;
    }

    /* Flex wrapper for slider + chart */
    .dual {
      display: flex;
      align-items: center;
    }
    #slider {
      width: 20px;      /* handle width */
      margin-right: 30px;
      /* height & margin-top will be set dynamically */
    }
    .noUi-vertical .noUi-handle {
      width: 20px;
      height: 20px;
      right: -7px;
    }
    .box canvas {
      display: block;
      width: 100% !important;
      height: auto !important;
      border-radius: 12px;
    }

    @media (max-width:600px) {
      .dual { flex-direction: column; }
      #slider { margin: 0 0 20px; }
    }
  </style>
</head>

<body>
  <!-- theme toggle -->
  <label class="switch">
    <input type="checkbox" id="themeToggle">
    <span class="slider-switch"></span>
  </label>

  <div class="container">
    <div class="box">
      <div class="dual">
        <!-- Vertical dual-handle slider -->
        <div id="slider"></div>
        <!-- Chart.js canvas -->
        <canvas id="timeSeriesChart"></canvas>
      </div>
    </div>
  </div>

  <script>
    // theme toggle
    const bodyEl = document.body;
    document.getElementById('themeToggle')
      .addEventListener('change', e => {
        bodyEl.classList.toggle('dark', e.target.checked);
        if (window.myChart) window.myChart.update();
      });
  </script>

  <script>
    // 1) Sample time-series data
    const data = [
      { time:'2025-05-01', value:10 },
      { time:'2025-05-02', value:12 },
      { time:'2025-05-03', value:8  },
      { time:'2025-05-04', value:14 },
      { time:'2025-05-05', value:11 },
      { time:'2025-05-06', value:9  },
      { time:'2025-05-07', value:13 },
      { time:'2025-05-08', value:7  }
    ];

    // 2) Chart.js gradient factory
    const ctx = document.getElementById('timeSeriesChart').getContext('2d');
    function makeGradient() {
      const h = ctx.canvas.getBoundingClientRect().height;
      const g = ctx.createLinearGradient(0, 0, 0, h);
      const root = getComputedStyle(document.documentElement);
      g.addColorStop(0, root.getPropertyValue('--chart-grad-start').trim());
      g.addColorStop(1, root.getPropertyValue('--chart-grad-end').trim());
      return g;
    }

    // 3) plugin to draw thresholds
    const thresholdPlugin = {
      id: 'thresholdPlugin',
      beforeDraw(chart) {
        const {ctx, chartArea:{left,right}, scales:{y}} = chart;
        const {min, max} = chart.config.options.thresholds;
        ctx.save();
        ctx.setLineDash([6,4]);

        // min line
        ctx.beginPath();
        ctx.strokeStyle = 'crimson';
        ctx.moveTo(left, y.getPixelForValue(min));
        ctx.lineTo(right, y.getPixelForValue(min));
        ctx.stroke();

        // max line
        ctx.beginPath();
        ctx.strokeStyle = 'seagreen';
        ctx.moveTo(left, y.getPixelForValue(max));
        ctx.lineTo(right, y.getPixelForValue(max));
        ctx.stroke();

        ctx.restore();
      }
    };

    // 3a) plugin to sync slider to exact y-scale pixels
    const syncHeightPlugin = {
      id: 'syncHeightPlugin',
      afterLayout(chart) {
        const sliderEl = document.getElementById('slider');
        const yScale = chart.scales.y;
        const topPx    = yScale.getPixelForValue(chart.options.scales.y.max);
        const bottomPx = yScale.getPixelForValue(chart.options.scales.y.min);
        const OFFSET = 40;
        sliderEl.style.marginTop = `${topPx - OFFSET}px`;
        sliderEl.style.height    = `${(bottomPx - topPx)}px`;
      }
    };

    // 4) Instantiate the chart with both plugins
    window.myChart = new Chart(ctx, {
      type:'line',
      data:{ datasets:[{
        label:'Series',
        data: data.map(d=>({x:d.time,y:d.value})),
        fill: true,
        backgroundColor: makeGradient(),
        borderColor: getComputedStyle(document.documentElement).getPropertyValue('--chart-line').trim(),
        pointRadius:5,
        pointBackgroundColor: data.map(()=> getComputedStyle(document.documentElement).getPropertyValue('--chart-line').trim()),
        tension:0.3
      }]},
      options:{
        responsive:true,
        scales:{
          x:{
            type:'time',
            time:{ unit:'day' },
            grid:{ display:false },
            ticks:{ color: getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim() }
          },
          y:{
            min: 0, max: 15,
            grid:{
              drawBorder:false,
              color: getComputedStyle(document.documentElement).getPropertyValue('--shadow-dark').trim()
            },
            ticks:{ color: getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim() }
          }
        },
        plugins:{
          legend:{ display:false },
          tooltip:{
            backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--bg-color').trim(),
            titleColor: getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim(),
            bodyColor: getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim(),
            borderColor: getComputedStyle(document.documentElement).getPropertyValue('--shadow-dark').trim(),
            borderWidth:1
          }
        },
        thresholds:{ min:8, max:12 }
      },
      plugins:[ syncHeightPlugin, thresholdPlugin ]
    });

    // 5) Build the vertical dual-handle slider
    const slider = document.getElementById('slider');
    noUiSlider.create(slider, {
      start: [8, 12],
      connect: true,
      orientation: 'vertical',
      direction: 'rtl',
      range: { min: 0, max: 15 },
      step: 0.1,
      tooltips: [ true, true ],
      format:{
        to: v => parseFloat(v).toFixed(1),
        from: v => parseFloat(v)
      }
    });

    // 6) Update chart on slider move
    slider.noUiSlider.on('update', ([min, max]) => {
      min = parseFloat(min);
      max = parseFloat(max);
      myChart.options.thresholds.min = min;
      myChart.options.thresholds.max = max;

      // recolor points
      const base = getComputedStyle(document.documentElement).getPropertyValue('--chart-line').trim();
      myChart.data.datasets[0].pointBackgroundColor =
        data.map(d => (d.value >= min && d.value <= max) ? 'seagreen' : base);

      myChart.update();
    });

    // emit once to align everything initially
    slider.noUiSlider.emit('update');
  </script>
</body>
</html>
